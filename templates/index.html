{% extends 'partials/base.html' %}
{% load static %}


{% block css %}

<link href="{% static 'plugins/datatable/css/dataTables.bootstrap4.min.css' %}" rel="stylesheet" type="text/css">
<link href="{% static 'plugins/datatable/css/buttons.bootstrap4.min.css' %}" rel="stylesheet" type="text/css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


<style>
    .card-container {
        display: grid;
        grid-template-columns: 1fr;
        /* Cada tarjeta ocupar√° todo el ancho disponible */
        gap: 20px;
        /* Espacio entre las tarjetas */
    }


    /* Estilo para la descripci√≥n */
    .description {
        padding-left: 10px;
        padding-right: 10px;
    }


    /* Estilo para los comentarios */
    .comments {
        border-top: 1px solid #ccc;
        margin-top: 10px;
        padding-top: 5px;
        padding-right: 10px;
        padding-bottom: 10px;
    }

    /* Estilo para cada comentario */
    .comment {
        margin-bottom: 10px;
    }


    .comment-input-container {
        display: flex;
        /* Hace que los elementos internos se coloquen en l√≠nea */
        align-items: center;
        /* Centra verticalmente los elementos */
    }

    .comment-input {
        flex: 1;
        /* Hace que el input ocupe todo el espacio disponible */
        margin-right: 15px;
        /* Agrega un peque√±o espacio entre el input y el bot√≥n */
        padding-right: 10rem;
    }

    .btn-sm {
        /* Puedes ajustar el tama√±o del bot√≥n seg√∫n tus preferencias */
        padding: 5px 10px;
        font-size: 14px;
        height: 32px !important;
    }

    .form-control {
        padding: 0;
    }

    .full-content {
        display: none;
    }

    .show-less {
        display: none;
    }

    .custom-border {
        border: 1px solid #80808057;
        /* Define un borde transparente inicialmente */
        cursor: pointer;
        /* Cambia el cursor al puntero cuando pasas el mouse sobre el div */
    }

    .selectedDivMascotas {
        border-color: #229D98;
    }

    .selectedDiv {
        border-color: #229D98;
    }
</style>
{% endblock css %}
{% block content %}

<div id="app">
    <div class="container">
        <div class="row">
            <div class="col-lg-8  d-flex justify-content-center">
                <div class="card-container">
                    <div class="card shadow-sm  border rounded-3 mb-3" v-for="publicacion in datapublicaciones"
                        :key="publicacion.id" style="max-width: 600px;">
                        <div class="card-body p-3">
                            <div class="d-flex align-items-center">
                                <img src="{% static 'images/icons/user.png' %}" alt="image" class="rounded-circle me-3"
                                    style="width: 40px;">
                                <div>
                                    <h6 class="fw-bold mb-0">[[publicacion.usuario.first_name]]
                                        [[publicacion.usuario.last_name]]</h6>
                                    <p class="text-muted mb-0">[[publicacion.usuario.comuna]]</p>
                                </div>
                            </div>
                            <hr>
                            <div class="mb-3">
                                <a>
                                    <img :src="publicacion.foto_mascota" class="card-img-top"
                                        alt="Imagen de la publicaci√≥n">
                                </a>
                            </div>
                            <p class="text-muted mb-0">2 hours ago</p>
                            <p class="fw-normal text-muted mb-2">[[publicacion.descripcion]]<a
                                    class="fw-bold text-primary ms-2">ver mas</a></p>
                            <div class="comments">
                                <div class="comment">
                                    <a href=""><strong>Ver todos los comentarios</strong></a>
                                </div>
                                <!-- Puedes agregar m√°s comentarios aqu√≠ -->

                                <!-- Formulario para agregar un comentario -->
                                <form class="comment-form">
                                    {% csrf_token %}
                                    <div class="comment-input-container">
                                        <input class="form-control" type="text" class="comment-input" name="comentario"
                                            placeholder="Agrega un comentario..." required>
                                        <div>
                                            <button class="btn btn-primary btn-sm" type="submit">Comentar</button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-3 d-none d-lg-block">
                <div id="suggestions">
                    <!-- Contenido de sugerencias -->
                    <h5>Sugerencias para ti</h5>
                    <ul>
                        <li>
                            <img src="{% static 'images/avatar1.jpg' %}" alt="Avatar de usuario">
                            <span>Usuario1</span>
                        </li>
                        <li>
                            <img src="{% static 'images/avatar2.jpg' %}" alt="Avatar de usuario">
                            <span>Usuario2</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="nueva_publicacion" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Crea una nueva publicaci√≥n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div v-show="alert" class="alert alert-danger" role="alert">
                            [[mensaje]]
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-group">
                                <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                                <label for="" class="control-label">¬øPerdida o Busqueda de mascota?</label>
                                <div class="row">
                                    <div class="col" id="Perdida de mascota">
                                        <div class="card radius-15 mb-0 shadow-none custom-border"
                                            @click="CambiarTipoPublicacion('Perdida de mascota')"
                                            :class="{ 'selectedDiv': selectedDiv === 'Perdida de mascota' }">
                                            <div class="card-body text-center">
                                                <div
                                                    class="widgets-icons mx-auto rounded-circle bg-login-color text-white">
                                                    ‚ÅâÔ∏è
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col" id="Busqueda de mascota">
                                        <div class="card radius-15 mb-0 shadow-none custom-border"
                                            @click="CambiarTipoPublicacion('Busqueda de mascota')"
                                            :class="{ 'selectedDiv': selectedDiv === 'Busqueda de mascota' }">
                                            <div class="card-body text-center">
                                                <div
                                                    class="widgets-icons mx-auto rounded-circle bg-login-color text-white">
                                                    üîé
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-2">
                            <div class="form-group">
                                <label for="" class="control-label">¬øPerro o Gato?</label>
                                <div class="row">
                                    <div class="col" id="Perro">
                                        <div class="card radius-15 mb-0 shadow-none custom-border"
                                            @click="CambiarTipoMascota('Perro')"
                                            :class="{ 'selectedDivMascotas': selectedDivMascotas === 'Perro' }">
                                            <div class="card-body text-center">
                                                <div
                                                    class="widgets-icons mx-auto rounded-circle bg-login-color text-white">
                                                    üê∂
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col" id="Gato">
                                        <div class="card radius-15 mb-0 shadow-none custom-border"
                                            @click="CambiarTipoMascota('Gato')"
                                            :class="{ 'selectedDivMascotas': selectedDivMascotas === 'Gato' }">
                                            <div class="card-body text-center">
                                                <div
                                                    class="widgets-icons mx-auto rounded-circle bg-login-color text-white">
                                                    üê±
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8 mb-2">
                            <div class="form-group">
                                <label for="" class="control-label">Descripci√≥n: </label>
                                <textarea v-model="nueva_publicacion.descripcion" class="form-control"
                                    id="exampleFormControlTextarea1" rows="3"></textarea>
                            </div>
                        </div>
                        <div class="col-md-4 mb-2 mt-4">
                            <div class="form-group">
                                <div class="col">
                                    <div class="form-group">
                                        <label for="" class="control-label">Imagen de referencia: </label>
                                        <input v-on:change="PreviewPhotoCrear($event)" type="file" class="form-control">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" @click="CrearPublicaciones()" data-bs-target="#nuevo_usuario"
                        class="btn btn-primary">Crear</button>
                </div>
            </div>
        </div>
    </div>
</div>



{% endblock content %}


{% block js %}

<script>
    $(document).ready(function () {
        $('.show-more').click(function () {
            $('.short-content').hide();
            $('.full-content').show();
            $('.show-more').hide();
            $('.show-less').show();
        });

        $('.show-less').click(function () {
            $('.full-content').hide();
            $('.short-content').show();
            $('.show-less').hide();
            $('.show-more').show();
        });
    });
</script>

<script>
    var app = new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data: {
            mensaje: "Por favor completa el campo",
            alert: false,
            datapublicaciones: [],
            publicacion_id: "",
            selectedDivMascotas: null,
            selectedDiv: null,
            url_preview: "",
            nueva_publicacion: {
                tipo_mascota: "",
                descripcion: "",
                foto_mascota: "", // Inicializado como nulo o como sea apropiado
                tipo_publicacion: "",
            },
        },
        mounted() {
            this.Getpublicacionesall();
        },
        methods: {
            Getpublicacionesall() {
                axios.get("/api/get_allpublicaciones").then((response) => {
                    this.datapublicaciones = response.data
                    console.log(response.data)
                    console.log(this.datapublicaciones)
                })
            },
            CambiarTipoMascota(id) {
                // Resetea la clase de la div previamente seleccionada
                if (this.selectedDivMascotas) {
                    const divAnterior = document.getElementById(this.selectedDivMascotas);
                    divAnterior.classList.remove('selectedDivMascotas');
                }

                // Cambia la clase de la nueva div seleccionada
                const divCambiarColor = document.getElementById(id);
                divCambiarColor.classList.add('selectedDivMascotas');
                this.selectedDivMascotas = id; // Actualiza la variable selectedDiv con el nuevo ID

                // Adem√°s, actualiza la variable nueva_publicacion.tipo_mascota
                this.nueva_publicacion.tipo_mascota = id;
                console.log(this.nueva_publicacion.tipo_mascota)
            },
            CambiarTipoPublicacion(id) {
                // Resetea la clase de la div previamente seleccionada
                if (this.selectedDiv) {
                    const divAnterior = document.getElementById(this.selectedDiv);
                    divAnterior.classList.remove('selectedDiv');
                }

                // Cambia la clase de la nueva div seleccionada
                const divCambiarColor = document.getElementById(id);
                divCambiarColor.classList.add('selectedDiv');
                this.selectedDiv = id; // Actualiza la variable selectedDiv con el nuevo ID

                this.nueva_publicacion.tipo_publicacion = id;
                console.log(this.nueva_publicacion.tipo_publicacion)
            },
            CrearPublicaciones() {
                let data = new FormData();
                const header_data = {
                    'Content-Type': 'multipart/form-data'
                };

                // Obtener el token CSRF del formulario
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

                data.append("csrfmiddlewaretoken", csrfToken);  // Incluir el token CSRF en la solicitud
                data.append("tipo_mascota", this.nueva_publicacion.tipo_mascota);
                data.append("descripcion", this.nueva_publicacion.descripcion);
                data.append("foto_mascota", this.nueva_publicacion.foto_mascota);
                data.append("tipo_publicacion", this.nueva_publicacion.tipo_publicacion);

                axios.post("/api/create/publicaciones", data, { headers: header_data })
                    .then((response) => {
                        // Comprobar si se registr√≥ correctamente o si hubo un error
                        if (response.data.success) {
                            // Agregar la nueva publicaci√≥n al principio de la lista
                            const nuevaPublicacion = {
                                id: response.data.publicacion_id,  // Supongamos que la API devuelve el ID de la nueva publicaci√≥n
                                usuario: {
                                    first_name: "Nombre",  // Reemplaza con los datos reales del usuario
                                    last_name: "Apellido",
                                    comuna: "Comuna",
                                },
                                // Otras propiedades de la nueva publicaci√≥n
                            };
                            this.datapublicaciones.unshift(nuevaPublicacion);
                            window.location.reload();
                        } else {
                            console.error("Error en la respuesta:", response);
                        }
                    })
                    .catch((error) => {
                        console.error("Error en la solicitud:", error);
                    });
            },
            PreviewPhotoCrear(event) {
                this.url_preview = URL.createObjectURL(event.target.files[0])
                this.nueva_publicacion.foto_mascota = event.target.files[0]
            },

        },
    })
</script>

{% endblock js %}